# http://www.gnu.org/software/automake/manual/make/Quick-Reference.html
# $@ The file name of the target.
# $% The target member name, when the target is an archive member.
# $< The name of the first prerequisite.
# $? The names of all the prerequisites that are newer than the target, with spaces between them. For prerequisites which are archive members, only the member named is used (see Archives).
# $^ $+ The names of all the prerequisites, with spaces between them. For prerequisites which are archive members, only the member named is used (see Archives). The value of $^ omits duplicate prerequisites, while $+ retains them and preserves their order.
# $* The stem with which an implicit rule matches (see How Patterns Match). 


default:
	make -f Makefile 
	cp bin/* $(OCAMLDEST)

tags:
	taggage /home/matsen/pplacer/ocaml/*/*.ml

mamba_release:
	rsync -avz --exclude .git --exclude _build --delete /home/matsen/pplacer/ocaml/ mamba:pplacer_ocaml
	ssh mamba "export PATH=/home/matsen/src/godi/bin:/usr/bin:/bin && cd pplacer_ocaml && make && ./complete_distr.sh"
	scp mamba:pplacer_ocaml/*.tar.gz ../builds

voldemort_release:
	rsync -avz --exclude _build --exclude .git --exclude myocamlbuild.ml --exclude _tags --delete /home/matsen/pplacer/ocaml/ voldemort:pplacer_ocaml
	ssh voldemort "cd pplacer_ocaml && rm -rf bin && make mac && ./complete_distr.sh"
	scp voldemort:pplacer_ocaml/*.tar.gz ../builds

install_builds:
	scp ../builds/* mamba.fhcrc.org:www/pplacer/builds/

release:
	make -f build_makefile mamba_release voldemort_release
	make -f build_makefile install_builds
	echo "RELEASE INSTALLED"

hyrax_install:
	scp bin/* pplacer@hyrax.fhcrc.org:bin/

%:
	make -f Makefile $@

.PHONY: $(RELEASE) clean commit runcaml mamba_release voldemort_release release 
